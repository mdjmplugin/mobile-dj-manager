var mdjm_admin_vars;jQuery(document).ready(function(e){e(".mdjm-select-chosen").chosen({inherit_select_classes:!0,placeholder_text_single:mdjm_admin_vars.one_option,placeholder_text_multiple:mdjm_admin_vars.one_or_more_option}),e(".mdjm-select-chosen .chosen-search input").each(function(){var t=e(this).parent().parent().parent().prev("select.mdjm-select-chosen").data("search-placeholder");e(this).attr("placeholder",t)}),e(".chosen-choices").on("click",function(){var t=e(this).parent().prev().data("search-placeholder");void 0===t&&(t=mdjm_admin_vars.type_to_search),e(this).children("li").children("input").attr("placeholder",t)}),e(document).on("click",".notice-mdjm-dismiss .notice-dismiss",function(){var t={notice:e(this).closest(".notice-mdjm-dismiss").data("notice"),action:"mdjm_dismiss_notice"};e.ajax({type:"POST",dataType:"json",data:t,url:ajaxurl})});var t=function(){var t=e("#_mdjm_event_deposit").val(),n={current_cost:e("#_mdjm_event_cost").val(),action:"update_event_deposit"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e("#_mdjm_event_deposit").attr("readonly",!0),e("#mdjm-event-pricing-detail").addClass("mdjm-mute")},success:function(n){"success"===n.type?e("#_mdjm_event_deposit").val(n.deposit):(alert(n.msg),e("#_mdjm_event_deposit").val(t)),e("#mdjm-event-pricing-detail").removeClass("mdjm-mute"),e("#_mdjm_event_deposit").attr("readonly",!1)}}).fail(function(n){window.console&&window.console.log&&console.log(n),e("#_mdjm_event_deposit").val(t)})},n=function(){var n,a=e("#_mdjm_event_cost").val();n="manual"===e("#venue_id").val()||"client"===e("#venue_id").val()?[e("#venue_address1").val(),e("#venue_address2").val(),e("#venue_town").val(),e("#venue_county").val(),e("#venue_postcode").val()]:e("#venue_id").val();var m={addons:e("#event_addons").val()||[],package:e("#_mdjm_event_package option:selected").val(),event_id:e("#post_ID").val(),current_cost:e("#_mdjm_event_cost").val(),event_date:e("#_mdjm_event_date").val(),venue:n,employee_id:e("#_mdjm_event_dj").val(),additional:e("#_mdjm_event_additional_cost").val(),discount:e("#_mdjm_event_discount").val(),action:"mdjm_update_event_cost"};e.ajax({type:"POST",dataType:"json",data:m,url:ajaxurl,beforeSend:function(){e("#mdjm-event-pricing-detail").addClass("mdjm-mute")},success:function(n){if("success"===n.type){e("#_mdjm_event_package_cost").val(n.package_cost),e("#_mdjm_event_addons_cost").val(n.addons_cost),e("#_mdjm_event_travel_cost").val(n.travel_cost),e("#_mdjm_event_additional_cost").val(n.additional_cost),e("#_mdjm_event_discount").val(n.discount);var m=Number(n.package_cost)+Number(n.addons_cost)+Number(n.travel_cost)+Number(n.additional_cost);m=(m=Number(m)-Number(n.discount)).toFixed(2),e("#_mdjm_event_cost").val(m),mdjm_admin_vars.update_deposit&&t()}else e("#_mdjm_event_cost").val(a);e("#mdjm-event-pricing-detail").removeClass("mdjm-mute")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})},a=function(){var t;t="manual"===e("#venue_id").val()||"client"===e("#venue_id").val()?[e("#venue_address1").val(),e("#venue_address2").val(),e("#venue_town").val(),e("#venue_county").val(),e("#venue_postcode").val()]:e("#venue_id").val();var n={employee_id:e("#_mdjm_event_dj").val(),venue:t,action:"mdjm_update_travel_data"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,success:function(t){"success"===t.type?(e(".mdjm-travel-distance").parents("tr").show(),e(".mdjm-travel-directions").parents("tr").show(),e(".mdjm-travel-distance").html(t.distance),e(".mdjm-travel-time").html(t.time),e(".mdjm-travel-cost").html(t.cost),e("#travel_directions").attr("href",t.directions_url),e("#mdjm_travel_distance").val(t.distance),e("#mdjm_travel_time").val(t.time),e("#mdjm_travel_cost").val(t.raw_cost),e("#mdjm_travel_directions_url").val(t.directions_url)):(e(".mdjm-travel-distance").parents("tr").hide(),e("#travel-directions").attr("href",""),e(".mdjm-travel-directions").parents("tr").hide(),e("#mdjm_travel_distance").val(""),e("#mdjm_travel_time").val(""),e("#mdjm_travel_cost").val(""),e("#mdjm_travel_directions_url").val(""))}}).fail(function(e){window.console&&window.console.log&&console.log(e)})};({init:function(){this.general(),"admin_page_mdjm-custom-event-fields"!==mdjm_admin_vars.current_page&&"admin_page_mdjm-custom-client-fields"!==mdjm_admin_vars.current_page||this.custom_fields()},general:function(){var t=e(".mdjm-color-picker");t.length&&t.wpColorPicker()},custom_fields:function(){jQuery(document).ready(function(e){e(".mdjm-client-list-item").sortable({handle:".mdjm_draghandle",items:".mdjm_sortable_row",opacity:.6,cursor:"move",axis:"y",update:function(){var t=e(this).sortable("serialize",{expression:/ (.+) = (.+) /})+"&action=mdjm_update_client_field_order";e.post(ajaxurl,t,function(){})}})}),e(".mdjm-custom-client-list-item,.mdjm-custom-event-list-item,.mdjm-custom-venue-list-item").sortable({handle:".mdjm_draghandle",items:".mdjm_sortable_row",opacity:.6,cursor:"move",axis:"y",update:function(){var t=e(this).sortable("serialize")+"&action=order_custom_event_fields";e.post(ajaxurl,t,function(){})}})}}).init(),{init:function(){this.options(),this.absence(),this.checker()},options:function(){e(document.body).on("click",".toggle-availability-checker-section",function(t){t.preventDefault(),e(this).html()===mdjm_admin_vars.show_avail_form?e(this).html(mdjm_admin_vars.hide_avail_form):e(this).html(mdjm_admin_vars.show_avail_form),e(".mdjm-availability-checker-fields").slideToggle()}),e(document.body).on("click",".toggle-add-absence-section",function(t){t.preventDefault();var n=e(this).html()===mdjm_admin_vars.show_absence_form;n?e(this).html(mdjm_admin_vars.hide_absence_form):e(this).html(mdjm_admin_vars.show_absence_form);var a=e(this).parents(".mdjm-availability-row-header");a.siblings(".mdjm-availability-add-absence-sections-wrap").slideToggle(),e("#absence_all_day").is(":checked")&&(e(".mdjm-absence-start-time-option").hide("fast"),e(".mdjm-absence-end-time-option").hide("fast")),e(":input:not(input[type=button],input[type=submit],button):visible:first",n?a.siblings(".mdjm-availability-add-absence-sections-wrap"):a.siblings(".mdjm-repeatable-row-standard-fields")).focus()}),e(document.body).on("change","#absence_all_day",function(){e(".mdjm-absence-start-time-option").slideToggle(),e(".mdjm-absence-end-time-option").slideToggle()})},absence:function(){e(document.body).on("click","#add-absence",function(t){t.preventDefault();var n=e("#absence_employee_id").val(),a=e("#absence_start").val(),m=e("#absence_end").val(),o=e("#absence_all_day").is(":checked")?1:0,i=e("#absence_start_time_hr").val(),s=e("#absence_start_time_min").val(),l=0,d=e("#absence_end_time_hr").val(),c=e("#absence_end_time_min").val(),_=0,r=e("#absence_notes").val();if("H:i"!==mdjm_admin_vars.time_format&&(l=e("#absence_start_time_period").val(),_=e("#absence_end_time_period").val()),a)if(m){var v={employee_id:n,start_date:a,end_date:m,all_day:o,start_time_hr:i,start_time_min:s,start_time_period:l,end_time_hr:d,end_time_min:c,end_time_period:_,notes:r,action:"mdjm_add_employee_absence"};e.ajax({type:"POST",dataType:"json",data:v,url:ajaxurl,beforeSend:function(){e("#mdjm-add-absence-fields").addClass("mdjm-mute")},success:function(t){!0===t.success&&(e("#mdjm-calendar").fullCalendar("refetchEvents"),e("#mdjm-calendar").fullCalendar("gotoDate",t.date)),e("#display_absence_start").val(""),e("#absence_start").val(""),e("#display_absence_end").val(""),e("#absence_end").val(""),e("#absence_all_day").prop("checked, true"),e("#absence_start_time_hr").val("00"),e("#absence_start_time_min").val("00"),e("#absence_end_time_hr").val("00"),e("#absence_end_time_min").val("00"),e("#absence_notes").val(""),"H:i"!==mdjm_admin_vars.time_format&&(e("#absence_start_time_period").val("am"),e("#absence_end_time_period").val("am")),e("#mdjm-calendar").removeClass("mdjm-mute"),e("#mdjm-add-absence-fields").removeClass("mdjm-mute"),e("html, body").animate({scrollTop:e(".toggle-add-absence-section").offset().top},500),e(".toggle-add-absence-section").trigger("click")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}else e("#display_absence_end").addClass("mdjm-form-error");else e("#display_absence_start").addClass("mdjm-form-error")}),e(document.body).on("click",".delete-absence",function(t){t.preventDefault(),e("#mdjm-calendar").addClass("mdjm-mute");var n={id:e(this).data("entry"),action:"mdjm_delete_employee_absence"};e.ajax({type:"POST",url:ajaxurl,dataType:"json",data:n,success:function(t){!0===t.success&&(e("#mdjm-calendar").fullCalendar("refetchEvents"),e(".popover").hide("fast")),e("#mdjm-calendar").removeClass("mdjm-mute")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})})},checker:function(){e(document.body).on("click","#check-availability",function(){var t=e("#check_date"),n=e("#display_date"),a=e("#display_date"),m=e("#check_roles");if(t.val()&&n.val()){var o={date:t,employees:a,roles:m,action:"do_availability_check_ajax"};e.ajax({type:"POST",dataType:"json",data:o,url:ajaxurl,beforeSend:function(){e("#mdjm_availability_fields").addClass("mdjm-mute")},success:function(){e("#mdjm_availability_fields").removeClass("mdjm-mute")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}else n.addClass("mdjm-form-error")})}}.init(),{init:function(){this.options(),this.client(),this.employee(),this.equipment(),this.playlist(),this.tasks(),this.time(),this.travel(),this.type(),this.txns(),this.venue()},options:function(){e(document.body).on("click",".toggle-event-options-section",function(t){t.preventDefault(),e(this).html()===mdjm_admin_vars.show_event_options?e(this).html(mdjm_admin_vars.hide_event_options):e(this).html(mdjm_admin_vars.show_event_options),e(".mdjm-event-options-sections-wrap").slideToggle()})},client:function(){e(document.body).on("click",".toggle-client-add-option-section",function(t){t.preventDefault();var n=e(this).html()===mdjm_admin_vars.show_client_form;n?e(this).html(mdjm_admin_vars.hide_client_form):e(this).html(mdjm_admin_vars.show_client_form);var a=e(this).parents(".mdjm-client-row-header");a.siblings(".mdjm-client-add-event-sections-wrap").slideToggle(),e(":input:not(input[type=button],input[type=submit],button):visible:first",n?a.siblings(".mdjm-client-add-event-sections-wrap"):a.siblings(".mdjm-repeatable-row-standard-fields")).focus()}),e(document.body).on("click",".toggle-client-details-option-section",function(t){t.preventDefault();var n=e(this).html()===mdjm_admin_vars.show_client_details;n?e(this).html(mdjm_admin_vars.hide_client_details):e(this).html(mdjm_admin_vars.show_client_details);var a=e(this).parents(".mdjm-client-row-header");a.siblings(".mdjm-client-details-event-sections-wrap").slideToggle(),n||e(":input:not(input[type=button],input[type=submit],button):visible:first",a.siblings(".mdjm-repeatable-row-standard-fields")).focus()}),e(document.body).on("click","#toggle_client_details",function(){e("#mdjm-event-client-details").toggle("slow")}),e(document.body).on("change","#client_name",function(t){if(t.preventDefault(),""!==e("#client_name").val())if("mdjm_add_client"===e("#client_name").val())e("#mdjm-event-add-new-client-fields").show("slow");else{e("#mdjm-event-add-new-client-fields").hide("slow");var n={client_id:e("#client_name").val(),event_id:e("#post_ID").val(),action:"mdjm_refresh_client_details"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e("#mdjm-event-client-details").replaceWith('<div id="mdjm-loading" class="mdjm-loader"><img src="'+mdjm_admin_vars.ajax_loader+'" /></div>')},success:function(t){e("#mdjm-loading").replaceWith(t.client_details)}}).fail(function(t){e("#mdjm-event-client-details").replaceWith('<div id="mdjm-loading" class="mdjm-loader"><img src="'+mdjm_admin_vars.ajax_loader+'" /></div>'),window.console&&window.console.log&&console.log(t)})}else e("#mdjm-event-add-new-client-fields").hide("slow")}),e(document.body).on("click","#mdjm-add-client",function(t){if(t.preventDefault(),e("#client_firstname").val().length<1)e("#client_firstname").addClass("mdjm-form-error");else if(e("#client_email").val().length<1)e("#client_email").addClass("mdjm-form-error");else{var n={client_firstname:e("#client_firstname").val(),client_lastname:e("#client_lastname").val(),client_email:e("#client_email").val(),client_address1:e("#client_address1").val(),client_address2:e("#client_address2").val(),client_town:e("#client_town").val(),client_county:e("#client_county").val(),client_postcode:e("#client_postcode").val(),client_phone:e("#client_phone").val(),client_phone2:e("#client_phone2").val(),action:"mdjm_event_add_client"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e(".mdjm-client-option-fields").addClass("mdjm-mute"),e("#mdjm-add-client").hide("fast")},success:function(t){e("#mdjm-add-client-fields").slideToggle(),e("#add-client-action").html(mdjm_admin_vars.show_client_form),e("#client_name").empty(),e("#client_firstname").val(""),e("#client_lastname").val(""),e("#client_email").val(""),e("#client_address1").val(""),e("#client_address2").val(""),e("#client_town").val(""),e("#client_county").val(""),e("#client_postcode").val(""),e("#client_phone").val(""),e("#client_phone2").val(""),e("#client_name").append(t.client_list),e("#mdjm-add-client").show("fast"),e("#_mdjm_event_block_emails").prop("checked",!1),e("#mdjm_reset_pw").prop("checked",!0),e("#client_name").trigger("chosen:updated"),e(".mdjm-client-option-fields").removeClass("mdjm-mute"),"error"===t.type&&alert(t.message)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}}),e(document.body).on("click","#toggle_custom_client_fields",function(){e("#mdjm_event_custom_client_fields").toggle("fast")}),e(document.body).on("click","#toggle_custom_event_fields",function(){e("#mdjm_event_custom_event_fields").toggle("fast")}),e(document.body).on("click","#toggle_custom_venue_fields",function(){e("#mdjm_event_custom_venue_fields").toggle("fast")})},employee:function(){e(document.body).on("click","#new_mdjm_role",function(t){if(t.preventDefault(),e("#add_mdjm_role").hasClass("mdjm-form-error")&&e("#add_mdjm_role").removeClass("mdjm-form-error"),e("#add_mdjm_role").val().length<1)e("#add_mdjm_role").addClass("mdjm-form-error");else{var n={role_name:e("#add_mdjm_role").val(),action:"mdjm_add_role"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e('input[type="submit"]').prop("disabled",!0),e("#new_mdjm_role").hide(),e("#pleasewait").show(),e("#all_roles").addClass("mdjm-mute"),e("#employee_role").addClass("mdjm-mute"),e("#all_roles").fadeTo("slow",.5),e("#employee_role").fadeTo("slow",.5)},success:function(t){"success"===t.type?(e("#all_roles").empty(),e("#employee_role").empty(),e("#all_roles").append(t.options),e("#employee_role").append(t.options),e("#add_mdjm_role").val(""),e("#all_roles").fadeTo("slow",1),e("#all_roles").removeClass("mdjm-mute"),e("#employee_role").fadeTo("slow",1),e("#employee_role").removeClass("mdjm-mute"),e('input[type="submit"]').prop("disabled",!1),e("#pleasewait").hide(),e("#new_mdjm_role").show()):(alert(t.msg),e("#all_roles").fadeTo("slow",1),e("#all_roles").removeClass("mdjm-mute"),e("#employee_role").fadeTo("slow",1),e("#employee_role").removeClass("mdjm-mute"),e('input[type="submit"]').prop("disabled",!1),e("#pleasewait").hide(),e("#new_mdjm_role").show())}})}}),e(document.body).on("click",".toggle-add-worker-section",function(t){t.preventDefault(),e(this).html()===mdjm_admin_vars.show_workers?e(this).html(mdjm_admin_vars.hide_workers):e(this).html(mdjm_admin_vars.show_workers),e(".mdjm-event-workers-sections-wrap").slideToggle(),e(".mdjm-event-workers-sections-wrap").is(":visible")&&e("#event_new_employee_role").focus()}),e(document.body).on("change","#event_new_employee_wage",function(){var t=e(this).val();t.length>0&&e(this).val(t.toFixed(2))}),e(document.body).on("click","#add_event_employee",function(t){t.preventDefault();var n={event_id:e("#post_ID").val(),employee_id:e("#event_new_employee").val(),employee_role:e("#event_new_employee_role").val(),employee_wage:e("#event_new_employee_wage").val(),action:"add_employee_to_event"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e(".mdjm-event-workers-sections-wrap").addClass("mdjm-mute"),e("#mdjm-event-employee-list").slideToggle()},success:function(t){"success"!==t.type&&alert(t.msg),e("#mdjm-event-employee-list").html(t.employees),e("#mdjm-event-employee-list").slideToggle(),e(".mdjm-event-workers-sections-wrap").removeClass("mdjm-mute"),e("#event_new_employee_role").val("").trigger("chosen:updated"),e("#event_new_employee").val("").trigger("chosen:updated"),e("#event_new_employee_wage").val("")}}).fail(function(t){e("#mdjm-event-employee-list").slideToggle(),e(".mdjm-event-workers-sections-wrap").removeClass("mdjm-mute"),window.console&&window.console.log&&console.log(t)})}),e(document.body).on("click",".remove_event_employee",function(t){t.preventDefault();var n={event_id:e("#post_ID").val(),employee_id:e(this).data("employee_id"),action:"remove_employee_from_event"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e(".mdjm-event-workers-sections-wrap").addClass("mdjm-mute"),e("#mdjm-event-employee-list").slideToggle()},success:function(t){"success"!==t.type&&alert("Error"),e("#mdjm-event-employee-list").html(t.employees),e("#mdjm-event-employee-list").slideToggle(),e(".mdjm-event-workers-sections-wrap").removeClass("mdjm-mute")}}).fail(function(t){e("#mdjm-event-employee-list").slideToggle(),e(".mdjm-event-workers-sections-wrap").removeClass("mdjm-mute"),window.console&&window.console.log&&console.log(t)})})},equipment:function(){e(document.body).on("change","#_mdjm_event_package,#event_addons,#_mdjm_event_additional_cost,#_mdjm_event_discount",function(){n()}),e(document.body).on("focusout","#_mdjm_event_cost",function(){mdjm_admin_vars.deposit_is_pct&&t()}),e(document.body).on("change","#_mdjm_event_dj,#mdjm_event_type,#display_event_date",function(t){t.preventDefault();var a=e("#_mdjm_event_deposit").val(),m={package:e("#_mdjm_event_package option:selected").val(),addons:e("#event_addons").val()||[],employee:e("#_mdjm_event_dj").val(),event_type:e("#mdjm_event_type").val(),event_date:e("#_mdjm_event_date").val(),action:"refresh_event_package_options"};e.ajax({type:"POST",dataType:"json",data:m,url:ajaxurl,beforeSend:function(){e("#mdjm-event-equipment-row").hide(),e("#mdjm-equipment-loader").show()},success:function(t){"success"===t.type?(e("#_mdjm_event_package").empty(),e("#_mdjm_event_package").append(t.packages),e("#_mdjm_event_package").trigger("chosen:updated"),e("#event_addons").empty(),e("#event_addons").append(t.addons),e("#event_addons").trigger("chosen:updated"),e("#mdjm-equipment-loader").hide(),e("#mdjm-event-equipment-row").show(),n()):alert(t.msg),e("#mdjm-equipment-loader").hide(),e("#mdjm-event-equipment-row").show()}}).fail(function(t){window.console&&window.console.log&&console.log(t),e("#_mdjm_event_deposit").val(a)})}),e(document.body).on("change","#_mdjm_event_package",function(t){t.preventDefault();var a={package:e("#_mdjm_event_package option:selected").val(),employee:e("#_mdjm_event_dj").val(),event_type:e("#mdjm_event_type").val(),event_date:e("#_mdjm_event_date").val(),selected:e("#event_addons").val()||[],action:"refresh_event_addon_options"};e.ajax({type:"POST",dataType:"json",data:a,url:ajaxurl,beforeSend:function(){e("#mdjm-event-equipment-row").hide(),e("#mdjm-equipment-loader").show()},success:function(t){"success"===t.type?(e("#event_addons").empty(),e("#event_addons").append(t.addons),e("#event_addons").trigger("chosen:updated"),n(),e("#mdjm-equipment-loader").hide(),e("#mdjm-event-equipment-row").show()):alert(t.msg),e("#mdjm-equipment-loader").hide(),e("#mdjm-event-equipment-row").show()}}).fail(function(e){window.console&&window.console.log&&console.log(e)})})},playlist:function(){e(document.body).on("change","#_mdjm_event_playlist",function(){e("#mdjm-playlist-limit").toggle("fast")})},tasks:function(){e(document.body).on("change","#mdjm_event_task",function(){"0"===e(this).val()?e("#mdjm-event-task-run").addClass("mdjm-hidden"):e("#mdjm-event-task-run").removeClass("mdjm-hidden")}),e(document.body).on("click","#mdjm-run-task",function(t){t.preventDefault(),e("#mdjm-event-tasks").addClass("mdjm-mute");var n=e("#mdjm_event_task").val(),a=e("#post_ID").val();if("reject-enquiry"!==n){var m={event_id:a,task:n,action:"mdjm_execute_event_task"};e.ajax({type:"POST",dataType:"json",data:m,url:ajaxurl,beforeSend:function(){e("#mdjm-run-task").addClass("mdjm-hidden"),e("#mdjm-spinner").css("visibility","visible")},complete:function(){e("#mdjm-event-tasks").removeClass("mdjm-mute")},success:function(t){t.success?(e("#mdjm-event-task-run").addClass("mdjm-hidden"),e("#mdjm_event_status").val(t.data.status),e("#mdjm_event_status").trigger("chosen:updated"),e(".task-history-items").html(t.data.history),e(".task-history-items").removeClass("description"),e("#mdjm-run-task").removeClass("mdjm-hidden"),e("#mdjm_event_task").val("0"),e("#mdjm_event_task").trigger("chosen:updated"),e("#mdjm-spinner").css("visibility","hidden")):alert("Error")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}else{var o={page:"mdjm-comms",recipient:e("#client_name").val(),template:mdjm_admin_vars.unavailable_template,event_id:a,"mdjm-action":"respond_unavailable"},i=mdjm_admin_vars.admin_url+"admin.php?";window.location.href=i+e.param(o)}})},time:function(){e(document.body).on("change","#display_event_date",function(){e("#dj_setup_date").val().length<1&&e("#dj_setup_date").val(e("#display_event_date").val())}),mdjm_admin_vars.setup_time_interval&&e(document.body).on("change","#event_start_hr, #event_start_min, #event_start_period",function(){var t=e("#event_start_hr").val(),n=e("#event_start_min").val(),a="",m=e("#_mdjm_event_date").val();"H:i"!==mdjm_admin_vars.time_format&&(a=" "+e("#event_start_period").val());var o={time:t+":"+n+a,date:m,action:"mdjm_event_setup_time"};e.ajax({type:"POST",dataType:"json",data:o,url:ajaxurl,success:function(t){e("#dj_setup_hr").val(t.data.hour),e("#dj_setup_min").val(t.data.minute),"H:i"!==mdjm_admin_vars.time_format&&e("#dj_setup_period").val(t.data.meridiem),(e("#dj_setup_date").val().length<1||e("#dj_setup_date").val()!==t.data.date)&&(e("#dj_setup_date").val(t.data.date),e("#_mdjm_event_djsetup").val(t.data.datepicker))}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}),e(document.body).on("change","#display_event_date",function(){e("#dj_setup_date").val().length<1&&e("#dj_setup_date").val(e("#display_event_date").val())}),e(document.body).on("change","#event_finish_hr, #event_finish_min, #event_finish_period, #display_event_finish_date",function(){var t=e("#event_start_hr").val(),n=e("#event_start_min").val(),a=e("#_mdjm_event_date").val().split("-"),m=new Date(a[0],a[1]-1,a[2]);m.setHours(t),m.setMinutes(n);var o=m,i=e("#event_finish_hr").val(),s=e("#event_finish_min").val(),l=e("#_mdjm_event_end_date").val().split("-"),d=new Date(l[0],l[1]-1,l[2]);d.setHours(i),d.setMinutes(s),d<o&&alert("Your event end date is before your start date. If the event finishes at midnight or later, please change the date to the next day first.")})},travel:function(){e(document.body).on("change","#venue_id",function(){"client"===e("#venue_id").val()&&t()}),e(document.body).on("change","#_mdjm_event_dj,#venue_address1,#venue_address2,#venue_town,#venue_county,#venue_postcode",function(){a(),e("#_mdjm_event_package").trigger("change")});var t=function(){if(e("#client_name").length){var t={client_id:e("#client_name").val(),action:"mdjm_set_client_venue"};e.ajax({type:"POST",dataType:"json",data:t,url:ajaxurl,success:function(t){t.address1&&e("#venue_address1").val(t.address1),t.address2&&e("#venue_address2").val(t.address2),t.town&&e("#venue_town").val(t.town),t.county&&e("#venue_county").val(t.county),t.postcode&&e("#venue_postcode").val(t.postcode),setTimeout(function(){a()},1e3),setTimeout(function(){n()},1750)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}}},type:function(){e(document.body).on("click",".toggle-event-type-option-section",function(t){t.preventDefault(),e(".mdjm-add-event-type-sections-wrap").slideToggle(),e(".mdjm-add-event-type-sections-wrap").is(":visible")&&e("#event_type_name").focus()}),e(document.body).on("click","#mdjm-add-event-type",function(t){t.preventDefault();var n={type:e("#event_type_name").val(),current:e("#mdjm_event_type").val(),action:"add_event_type"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e(".mdjm-event-option-fields").addClass("mdjm-mute"),e("#mdjm-add-event-type").hide("fast")},success:function(t){if(t){if("success"!==t.data.msg)return e("#event_type_name").addClass("mdjm-form-error"),void e("#mdjm-add-event-type").show("fast");e("#event_type_name").val(""),e(".mdjm-add-event-type-sections-wrap").slideToggle(),e("#mdjm_event_type").empty(),e("#mdjm_event_type").append(t.data.event_types),e("#mdjm_event_type").trigger("chosen:updated"),e("#mdjm-add-event-type").show("fast"),e(".mdjm-event-option-fields").removeClass("mdjm-mute")}else alert(t.data.msg),e("#mdjm-add-event-type").show("fast")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}),e(document.body).on("click","#mdjm_block_emails",function(){e(".mdjm-quote-template").toggle("fast")})},txns:function(){e(document.body).on("click","#mdjm_txn_toggle",function(){e("#mdjm_event_txn_table").toggle("slow")}),e(document.body).on("click","#toggle_add_txn_fields",function(){e("#mdjm_event_add_txn_table tbody").toggle("slow"),e("#save-event-txn").toggle("fast"),"show form"===e("#toggle_add_txn_fields").text()?e("#toggle_add_txn_fields").text("hide form"):e("#toggle_add_txn_fields").text("show form")}),e(document.body).on("change","#mdjm_txn_direction",function(){"In"===e("#mdjm_txn_direction").val()&&(e("#mdjm_txn_from_container").removeClass("mdjm-hidden"),e("#mdjm_txn_to_container").addClass("mdjm-hidden"),e("#mdjm-txn-email").removeClass("mdjm-hidden")),"Out"!==e("#mdjm_txn_direction").val()&&""!==e("#mdjm_txn_direction").val()||(e("#mdjm_txn_to_container").removeClass("mdjm-hidden"),e("#mdjm_txn_from_container").addClass("mdjm-hidden"),e("#mdjm-txn-email").addClass("mdjm-hidden"))}),e(document.body).on("click","#save_transaction",function(t){if(t.preventDefault(),e("#mdjm_txn_amount").val().length<1)return alert(mdjm_admin_vars.no_txn_amount),!1;if(e("#mdjm_txn_date").val().length<1)return alert(mdjm_admin_vars.no_txn_date),!1;if(e("#mdjm_txn_for").val().length<1)return alert(mdjm_admin_vars.no_txn_for),!1;if(e("#mdjm_txn_src").val().length<1)return alert(mdjm_admin_vars.no_txn_src),!1;var n={event_id:e("#post_ID").val(),client:e("#client_name").val(),amount:e("#mdjm_txn_amount").val(),date:e("#mdjm_txn_date").val(),direction:e("#mdjm_txn_direction").val(),from:e("#mdjm_txn_from").val(),to:e("#mdjm_txn_to").val(),for:e("#mdjm_txn_for").val(),src:e("#mdjm_txn_src").val(),send_notice:e("#mdjm_manual_txn_email").is(":checked")?1:0,action:"add_event_transaction"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e("#mdjm_event_txn_table").replaceWith('<div id="mdjm-loading" class="mdjm-loader"><img src="'+mdjm_admin_vars.ajax_loader+'" /></div>')},success:function(t){"success"===t.type?("Y"===t.deposit_paid&&e("#deposit_paid").prop("checked",!0),"Y"===t.balance_paid&&e("#balance_paid").prop("checked",!0),t.event_status!==e("#mdjm_event_status").val()&&e("#mdjm_event_status").val(t.event_status)):alert(t.msg),e("#mdjm-loading").replaceWith('<div id="mdjm_event_txn_table">'+t.transactions+"</div>")}}).fail(function(t){e("#mdjm-loading").replaceWith('<div id="mdjm_event_txn_table">'+response.transactions+"</div>"),window.console&&window.console.log&&console.log(t)})})},venue:function(){"post.php"===mdjm_admin_vars.current_page&&"manual"===e("#venue_id").val()&&e(".mdjm-add-event-venue-sections-wrap").show(),e(document.body).on("click",".toggle-event-view-venue-option-section",function(t){t.preventDefault(),e(this).html()===mdjm_admin_vars.show_venue_details?e(this).html(mdjm_admin_vars.hide_venue_details):e(this).html(mdjm_admin_vars.show_venue_details),e(".mdjm-event-venue-details-sections-wrap").slideToggle()}),e(document.body).on("click",".toggle-event-add-venue-option-section",function(t){t.preventDefault(),e(".mdjm-add-event-venue-sections-wrap").slideToggle(),e(".mdjm-add-event-venue-sections-wrap").is(":visible")&&e("#venue_name").focus()}),e(document.body).on("change","#venue_id",function(e){e.preventDefault(),o()}),e(document.body).on("click","#mdjm-add-venue",function(t){if(t.preventDefault(),e("#venue_name").val().length<1)e("#venue_name").addClass("mdjm-form-error");else{var n={venue_name:e("#venue_name").val(),venue_contact:e("#venue_contact").val(),venue_email:e("#venue_email").val(),venue_address1:e("#venue_address1").val(),venue_address2:e("#venue_address2").val(),venue_town:e("#venue_town").val(),venue_county:e("#venue_county").val(),venue_postcode:e("#venue_postcode").val(),venue_phone:e("#venue_phone").val(),action:"mdjm_add_venue"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e(".mdjm-event-option-fields").addClass("mdjm-mute"),e("#mdjm-add-venue").hide("fast")},success:function(t){e(".mdjm-add-event-venue-sections-wrap").slideToggle(),e("#venue_id").empty(),e("#venue_id").append(t.venue_list),e("#mdjm-add-venue").show(),e("#venue_id").trigger("chosen:updated"),o(),e(".mdjm-event-option-fields").removeClass("mdjm-mute"),"error"===t.type&&(alert(t.message),e("#mdjm-add-venue").show("fast"))}}).fail(function(t){e("#mdjm-add-venue").show("fast"),window.console&&window.console.log&&console.log(t)})}})}}.init();var m={init:function(){this.add(),this.remove(),this.price()},clone_repeatable:function(t){var n,a=1;return t.parent().find("tr.mdjm_repeatable_row").each(function(){var t=e(this).data("key");parseInt(t)>a&&(a=t)}),n=a+=1,clone=t.clone(),clone.find("select").each(function(){e(this).val(t.find('select[name="'+e(this).attr("name")+'"]').val())}),clone.removeClass("mdjm_add_blank"),clone.attr("data-key",n),clone.find("td input, td select, textarea").val(""),clone.find("input, select, textarea").each(function(){var t=e(this).attr("name"),a=e(this).attr("id");t&&(t=t.replace(/\[(\d+)\]/,"["+parseInt(n)+"]"),e(this).attr("name",t)),void 0!==a&&(a=a.replace(/(\d+)/,parseInt(n)),e(this).attr("id",a))}),clone.find("span.mdjm_price_id").each(function(){e(this).text(parseInt(n))}),clone.find("span.mdjm_file_id").each(function(){e(this).text(parseInt(n))}),clone.find(".mdjm_repeatable_default_input").each(function(){e(this).val(parseInt(n)).removeAttr("checked")}),clone.find(".search-choice").remove(),clone.find(".chosen-container").remove(),clone},add:function(){e(document.body).on("click",".submit .mdjm_add_repeatable",function(t){t.preventDefault();var n=e(this).parent().parent().prev("tr"),a=m.clone_repeatable(n);a.insertAfter(n).find("input, textarea, select").filter(":visible").eq(0).focus(),a.find(".mdjm-select-chosen").chosen({inherit_select_classes:!0,placeholder_text_multiple:mdjm_admin_vars.select_months}),a.find(".package-items").css("width","100%")})},move:function(){e(".mdjm_repeatable_table tbody").sortable({handle:".mdjm_draghandle",items:".mdjm_repeatable_row",opacity:.6,cursor:"move",axis:"y",update:function(){var t=0;e(this).find("tr").each(function(){e(this).find("input.mdjm_repeatable_index").each(function(){e(this).val(t)}),t++})}})},remove:function(){e(document.body).on("click",".mdjm_remove_repeatable",function(t){t.preventDefault();var n=e(this).parent().parent("tr"),a=n.parent().find("tr").length-1,m=e(this).data("type"),o="tr.mdjm_repeatable_"+m+"s";if("price"===m){var i=n.data("key");e('.mdjm_repeatable_condition_field option[value="'+i+'"]').remove()}if(a>1)e("input, select",n).val(""),n.fadeOut("fast").remove();else switch(m){case"price":alert(mdjm_admin_vars.one_month_min);break;case"item":alert(mdjm_admin_vars.one_item_min);break;default:alert(mdjm_admin_vars.one_month_min)}e(o).each(function(t){e(this).find("input, select").each(function(){var n=e(this).attr("name");n=n.replace(/\[(\d+)\]/,"["+t+"]"),e(this).attr("name",n).attr("id",n)})})})},price:function(){e(document.body).on("click","#_package_restrict_date",function(){e("#mdjm-package-month-selection").toggle("fast")}),e(document.body).on("click","#_addon_restrict_date",function(){e("#mdjm-addon-month-selection").toggle("fast")}),e(document.body).on("click","#_package_variable_pricing",function(){e("#mdjm-package-variable-price-fields").toggle("fast")}),e(document.body).on("click","#_addon_variable_pricing",function(){e("#mdjm-addon-variable-price-fields").toggle("fast")})}};function o(){if("manual"===e("#venue_id").val()||"client"===e("#venue_id").val())e(".mdjm-event-venue-details-sections-wrap").hide("fast"),e(".mdjm-add-event-venue-sections-wrap").show("fast");else{e(".mdjm-add-event-venue-sections-wrap").hide("fast");var t={venue_id:e("#venue_id").val(),event_id:e("#post_ID").val(),action:"mdjm_refresh_venue_details"};e.ajax({type:"POST",dataType:"json",data:t,url:ajaxurl,success:function(t){e("#mdjm-venue-details-fields").html(t.data.venue),e(".mdjm-event-venue-details-sections-wrap").show("fast"),e(".toggle-event-view-venue-option-section").html()===mdjm_admin_vars.show_venue_details&&e(".toggle-event-view-venue-option-section").html(mdjm_admin_vars.hide_venue_details)}}).fail(function(e){window.console&&window.console.log&&console.log(e)}),a()}e("#_mdjm_event_package").trigger("change")}m.init(),{init:function(){this.content()},content:function(){var t=function(t){var n={recipient:t,action:"mdjm_user_events_dropdown"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e("#mdjm_email_event").addClass("mdjm-updating"),e("#mdjm_email_event").fadeTo("slow",.5)},success:function(t){e("#mdjm_email_event").empty(),e("#mdjm_email_event").append(t.event_list),e("#mdjm_email_event").fadeTo("slow",1),e("#mdjm_email_event").removeClass("mdjm-updating")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})};mdjm_admin_vars.load_recipient&&(e("#mdjm_email_to").val(mdjm_admin_vars.load_recipient),t(mdjm_admin_vars.load_recipient)),e(document.body).on("change","#mdjm_email_to",function(n){n.preventDefault();var a=e("#mdjm_email_to").val();t(a)}),e(document.body).on("change","#mdjm_email_template",function(t){t.preventDefault();var n={template:e("#mdjm_email_template").val(),action:"mdjm_set_email_content"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e("#mdjm_email_subject").addClass("mdjm-updating"),e("#mdjm_email_subject").fadeTo("slow",.5),e("#mdjm_email_content").addClass("mdjm-updating"),e("#mdjm_email_content").fadeTo("slow",.5),e("#mdjm_email_template").addClass("mdjm-updating"),e("#mdjm_email_template").fadeTo("slow",.5),tinymce.execCommand("mceToggleEditor",!1,"mdjm_email_content")},success:function(t){"success"===t.type?(e("#mdjm_email_content").empty(),tinyMCE.activeEditor.setContent(""),e("#mdjm_email_subject").val(t.updated_subject),tinyMCE.activeEditor.setContent(t.updated_content),e("#mdjm_email_content").val(t.updated_content)):alert(t.msg),e("#mdjm_email_subject").fadeTo("slow",1),e("#mdjm_email_subject").removeClass("mdjm-updating"),e("#mdjm_email_content").fadeTo("slow",1),e("#mdjm_email_content").removeClass("mdjm-updating"),e("#mdjm_email_template").removeClass("mdjm-updating"),e("#mdjm_email_template").fadeTo("slow",1),tinymce.execCommand("mceToggleEditor",!1,"mdjm_email_content")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})})}}.init(),{init:function(){this.template_select()},template_select:function(){e(document.body).on("change","#mdjm_task_email_template",function(t){t.preventDefault();var n={template:e("#mdjm_task_email_template").val(),action:"mdjm_get_template_title"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e("#mdjm-task-email-subject").addClass("mdjm-updating"),e("#mdjm-task-email-subject").fadeTo("slow",.5)},success:function(t){t.title&&e("#mdjm-task-email-subject").val(t.title),e("#mdjm-task-email-subject").fadeTo("slow",1),e("#mdjm-task-email-subject").removeClass("mdjm-updating")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})})}}.init(),{init:function(){this.date_options()},date_options:function(){e("#mdjm-graphs-date-options").change(function(){var t=e(this),n=e("#mdjm-date-range-options");"other"===t.val()?n.show():n.hide()})}}.init(),{init:function(){this.submit(),this.dismiss_message()},submit:function(){var t=this;e(document.body).on("submit",".mdjm-export-form",function(n){n.preventDefault();var a=e(this).find('input[type="submit"]');if(!a.hasClass("button-disabled")){var m=e(this).serialize();a.addClass("button-disabled"),e(this).find(".notice-wrap").remove(),e(this).append('<div class="notice-wrap"><span class="spinner is-active"></span><div class="mdjm-progress"><div></div></div></div>'),t.process_step(1,m,t)}})},process_step:function(t,n,a){e.ajax({type:"POST",url:ajaxurl,data:{form:n,action:"mdjm_do_ajax_export",step:t},dataType:"json",success:function(t){if("done"===t.step||t.error||t.success){var m=e(".mdjm-export-form").find(".mdjm-progress").parent().parent(),o=m.find(".notice-wrap");if(m.find(".button-disabled").removeClass("button-disabled"),t.error){var i=t.message;o.html('<div class="updated error"><p>'+i+"</p></div>")}else if(t.success){var s=t.message;o.html('<div id="mdjm-batch-success" class="updated notice is-dismissible"><p>'+s+'<span class="notice-dismiss"></span></p></div>')}else o.remove(),window.location=t.url}else e(".mdjm-progress div").animate({width:t.percentage+"%"},50,function(){}),a.process_step(parseInt(t.step),n,a)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})},dismiss_message:function(){e("body").on("click","#mdjm-batch-success .notice-dismiss",function(){e("#mdjm-batch-success").parent().slideUp("fast")})}}.init(),"mdjm-event_page_mdjm-comms"===mdjm_admin_vars.current_page&&e("#mdjm_form_send_comms").validate({errorClass:"mdjm-form-error",validClass:"mdjm-form-valid",focusInvalid:!1,rules:{},messages:{mdjm_email_to:null,mdjm_email_subject:null,mdjm_email_content:null}}),mdjm_admin_vars.editing_event&&(e("#post").validate({errorClass:"mdjm-form-error",validClass:"mdjm-form-valid",focusInvalid:!1,rules:{client_name:{required:!0,minlength:1},display_event_date:{required:!0},_mdjm_event_cost:{number:!0},_mdjm_event_deposit:{number:!0}},messages:{client_name:null,display_event_date:null,_mdjm_event_cost:null,_mdjm_event_deposit:null}}),e(document.body).on("click","#save-post",function(){if(e("#_mdjm_event_cost").val()<"0.01")return confirm(mdjm_admin_vars.zero_cost)}))});var mdjmFormatCurrency=function(e){var t=parseFloat(e),n=mdjm_admin_vars.currency,a=mdjm_admin_vars.currency_decimals;return t.toLocaleString(n,{style:"currency",currency:n,minimumFractionDigits:a,maximumFractionDigits:a})},mdjmFormatNumber=function(e){var t=parseFloat(e),n=mdjm_admin_vars.currency;return t.toLocaleString(n,{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0})},mdjmLabelFormatter=function(e){return'<div style="font-size:12px; text-align:center; padding:2px">'+e+"</div>"},mdjmLegendFormatterSources=function(e,t){var n=e.toLowerCase().replace(/\s/g,"-"),a='<div class="mdjm-legend-color" style="background-color: '+t.color+'"></div>',m='<div class="mdjm-pie-legend-item">'+e+": "+Math.round(t.percent)+"% ("+mdjmFormatNumber(t.data[0][1])+")</div>",o='<div id="'+t.mdjm_vars.id+n+'" class="mdjm-legend-item-wrapper">'+a+m+"</div>";return jQuery("#mdjm-pie-legend-"+t.mdjm_vars.id).append(o),o},mdjmLegendFormatterEarnings=function(e,t){var n=e.toLowerCase().replace(/\s/g,"-"),a='<div class="mdjm-legend-color" style="background-color: '+t.color+'"></div>',m='<div class="mdjm-pie-legend-item">'+e+": "+Math.round(t.percent)+"% ("+mdjmFormatCurrency(t.data[0][1])+")</div>",o='<div id="'+t.mdjm_vars.id+n+'" class="mdjm-legend-item-wrapper">'+a+m+"</div>";return jQuery("#mdjm-pie-legend-"+t.mdjm_vars.id).append(o),o};